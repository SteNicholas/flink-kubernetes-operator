{
  "kind": "AdmissionReview",
  "apiVersion": "admission.k8s.io/v1beta1",
  "request": {
    "uid": "0df28fbd-5f5f-11e8-bc74-36e6bb280816",
    "kind": {
      "group": "",
      "version": "v1",
      "kind": "Pod"
    },
    "operation": "CREATE",
    "object": {
      "apiVersion": "flink.apache.org/v1alpha1",
      "kind": "FlinkDeployment",
      "metadata": {
        "namespace": "default",
        "name": "pod-template-example"
      },
      "spec": {
        "image": "flink:1.14.3",
        "flinkVersion": "1.14.3",
        "flinkConfiguration": {
          "taskmanager.numberOfTaskSlots": "2"
        },
        "podTemplate": {
          "apiVersion": "v1",
          "kind": "Pod",
          "metadata": {
            "name": "pod-template"
          },
          "spec": {
            "serviceAccount": "flink-operator",
            "containers": [
              {
                "name": "flink-main-container",
                "volumeMounts": [
                  {
                    "mountPath": "/opt/flink/log",
                    "name": "flink-logs"
                  }
                ]
              },
              {
                "name": "fluentbit",
                "image": "fluent/fluent-bit:1.8.12-debug",
                "command": [
                  "sh",
                  "-c",
                  "/fluent-bit/bin/fluent-bit -i tail -p path=/flink-logs/*.log -p multiline.parser=java -o stdout"
                ],
                "volumeMounts": [
                  {
                    "mountPath": "/flink-logs",
                    "name": "flink-logs"
                  }
                ]
              }
            ],
            "volumes": [
              {
                "name": "flink-logs",
                "emptyDir": {}
              }
            ]
          }
        },
        "jobManager": {
          "replicas": 1,
          "resource": {
            "memory": "2048m",
            "cpu": 1
          }
        },
        "taskManager": {
          "resource": {
            "memory": "2048m",
            "cpu": 1
          },
          "podTemplate": {
            "apiVersion": "v1",
            "kind": "Pod",
            "metadata": {
              "name": "task-manager-pod-template"
            },
            "spec": {
              "initContainers": [
                {
                  "name": "busybox",
                  "image": "busybox:latest",
                  "command": [
                    "sh",
                    "-c",
                    "echo hello from task manager"
                  ]
                }
              ]
            }
          }
        },
        "job": {
          "jarURI": "local:///opt/flink/examples/streaming/StateMachineExample.jar",
          "parallelism": 2
        }
      }
    }
  }
}
